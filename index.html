<!-- public/index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Testing</title>
  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getFunctions, httpsCallable, connectFunctionsEmulator } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-functions.js";

    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDhuc1LsStEPg-ksXXgnflQ2tu0dl5syHA",
      authDomain: "classicalmath.firebaseapp.com",
      projectId: "classicalmath",
      storageBucket: "classicalmath.firebasestorage.app",
      messagingSenderId: "115442672639",
      appId: "1:115442672639:web:ffd3308688abfcc5d63dca",
      measurementId: "G-05K9M3VQTK"
    };

    // Initialize Firebase if we're on the production site
    if (window.location.hostname === 'classicalmath.org') {
      const app = initializeApp(firebaseConfig);
      window.firebaseApp = app;
      window.getFunctions = getFunctions;
      window.httpsCallable = httpsCallable;
    } else {
      // Initialize Firebase for localhost
      const app = initializeApp(firebaseConfig);
      const functions = getFunctions(app);
      // Connect to local emulator
      connectFunctionsEmulator(functions, "localhost", 5001);
      window.firebaseApp = app;
      window.getFunctions = getFunctions;
      window.httpsCallable = httpsCallable;
    }
  </script>
</head>
<body>
  <h1>Testing</h1>
  <button onclick="pingServer()">Ping Server</button>
  <p id="response"></p>

  <script>
    // Local ping method
    function pingLocal() {
      return "pong";
    }

    // Server ping method that calls the Firebase Cloud Function
    async function pingServer() {
      try {
        const functions = getFunctions(window.firebaseApp);
        const pingFunction = httpsCallable(functions, 'ping');
        const result = await pingFunction();
        // Handle both emulator and production response formats
        const message = result.data?.message || result.message || "pong!";
        document.getElementById('response').textContent = message;
      } catch (error) {
        document.getElementById('response').textContent = "Error: " + error.message;
      }
    }
  </script>
</body>
</html>
